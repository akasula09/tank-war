<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>tank.html</title>
    <script type="text/javascript" src="functions.js"></script>
    <script type = "text/javascript">
        var ball;
        var goldTank;
        var missiles = [];
        var explosions = [];

        class Missile {
            constructor(x, y, direction) {
                this.x = x;
                this.y = y;
                this.speed = 5;
                this.life = 120; // 2 seconds * 60 frames per second
                this.direction = direction;
            }

            update() {
                this.x += this.speed * this.direction;
                this.life--;
            }

            draw(ctx) {
                if (this.life > 0) {
                    ctx.fillStyle = "yellow";
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                } else {
                    // draw explosion
                    ctx.fillStyle = "red";
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 10, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
        }

        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.life = 30; // 0.5 seconds * 60 frames per second
            }

            update() {
                this.life--;
            }

            draw(ctx) {
                if (this.life > 0) {
                    ctx.fillStyle = "red";
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 10, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
        }

     function update() {
    scene.clear();
    if (ball.health > 0) {
        ball.update();
        ball.draw(scene.ctx);
    }
    if (goldTank.health > 0) {
        goldTank.update();
        goldTank.draw(scene.ctx);
    }
    for (let i = 0; i < missiles.length; i++) {
        let missile = missiles[i];
        missile.update();
        missile.draw(scene.ctx);
        if (missile.direction === -1 && goldTank.collidesWith(missile)) {
            goldTank.health -= 10;
            missiles.splice(i, 1);
            i--;
            // add explosion
            let explosion = new Explosion(missile.x, missile.y);
            explosions.push(explosion);
        } else if (missile.direction === 1 && ball.collidesWith(missile)) {
            ball.health -= 10;
            missiles.splice(i, 1);
            i--;
            // add explosion
            let explosion = new Explosion(missile.x, missile.y);
            explosions.push(explosion);
        }
    }
    for (let i = 0; i < explosions.length; i++) {
        let explosion = explosions[i];
        explosion.update();
        explosion.draw(scene.ctx);
        if (explosion.life <= 0) {
            explosions.splice(i, 1);
            i--;
        }
    }
}


        function init() {
            scene = new Scene(update);
            ball = new Sprite(scene, "blueTank.png", 100, 100,"arrows");
            ball.x = (scene.width - ball.width) / 2;
            ball.y = (scene.height - ball.height) / 2;

            goldTank = new Sprite(scene, "goldTank.png", 100, 100,"wasd");
            goldTank.x = (scene.width - goldTank.width) / 4;
            goldTank.y = (scene.height - goldTank.height) / 4;

let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

document.addEventListener("keydown", (event) => {
    if (event.code === "Space") {
        let missile = new Missile(ball.x + ball.width / 2, ball.y + ball.height / 2, -1);
        missiles.push(missile);
    } else if (event.code === "Enter") {
        let missile = new Missile(goldTank.x + goldTank.width / 2, goldTank.y + goldTank.height / 2, 1);
        missiles.push(missile);
    }
});

canvas.addEventListener("mousemove", (event) => {
    let rect = canvas.getBoundingClientRect();
    let mouseX = event.clientX - rect.left;
    let mouseY = event.clientY - rect.top;
    let dx = mouseX - (ball.x + ball.width / 2);
    let dy = mouseY - (ball.y + ball.height / 2);
    ball.moveAngle = Math.atan2(dy, dx);
});

           
            scene.start();
        }
document.addEventListener("keydown", (event) => {
    if (["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].includes(event.key)) {
        event.preventDefault();
    }
});

    </script>
</head>
<body onload="init()" bgcolor="#000000">
<canvas id="canvas"></canvas>
</body>
</html>
